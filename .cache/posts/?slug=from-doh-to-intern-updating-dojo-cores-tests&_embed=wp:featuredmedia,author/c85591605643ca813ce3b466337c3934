{"value":{"body":"[{\"id\":10402,\"date\":\"2015-02-18T10:11:36\",\"date_gmt\":\"2015-02-18T17:11:36\",\"guid\":{\"rendered\":\"https://www.sitepen.com/blog/?p=10402\"},\"modified\":\"2015-02-18T10:11:36\",\"modified_gmt\":\"2015-02-18T17:11:36\",\"slug\":\"from-doh-to-intern-updating-dojo-cores-tests\",\"status\":\"publish\",\"type\":\"post\",\"link\":\"https://wp.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/\",\"title\":{\"rendered\":\"From DOH to Intern: Updating Dojo core&#8217;s tests\"},\"content\":{\"rendered\":\"<p><img loading=\\\"lazy\\\" src=\\\"https://wp.sitepen.com/wp-content/uploads/2013/05/intern_blog1.png\\\" alt=\\\"Intern\\\" width=\\\"196\\\" height=\\\"197\\\" style=\\\"margin:20px 0 15px 15px; float:right;\\\" /></p>\\n<p>One of the primary motivations for creating <a href=\\\"http://theintern.io/\\\">Intern</a> was to make support for continuous integration testing much easier to achieve with JavaScript-based application development. We recently <a href=\\\"https://github.com/dojo/dojo/commit/7b0a4207ef602f89a1240215e273e552cf20fa50\\\">converted the vast majority of the unit tests in Dojo core from DOH to Intern</a>, in order to streamline the process of regression testing patches for Dojo 1.x.</p>\\n<p>This was a very large amount of work, and we learned a number of interesting things along the way that should be useful to you in writing your own tests.</p>\\n<p><!--more--></p>\\n<h3>Limits for large projects</h3>\\n<p>The open source continuous integration and cloud testing stack of popular choice (travis-ci + SauceLabs) has relatively low limits (<a href=\\\"http://docs.travis-ci.com/user/build-configuration/#Job-Timeouts\\\">50 minutes before a job times out</a>), and the virtual machines provided by SauceLabs appear to be fairly underpowered, resulting in tests taking a fairly long time to run, and eventually failing as the time limit is reached. This is a problem as it means we cannot simply hook into these services to quickly validate each potential pull request against our test suite. We&#8217;re still working on a possible solution.</p>\\n<p>One of the main benefits provided by Dojo is a collection of packages that are tested to work with each other, and are generally consistent in their approach.</p>\\n<h3>Organization</h3>\\n<p>In our <a href=\\\"https://github.com/dojo/dojo/blob/master/tests/dojo.intern.js#L57-L88\\\">Intern config for Dojo</a>, we specify various package locations and maps to differentiate between Intern&#8217;s version of Dojo that is used internally by Intern, and Dojo&#8217;s version of Dojo. We also have test modules created to <a href=\\\"https://github.com/dojo/dojo/blob/master/tests/unit/all.js\\\">aggregate over all of our tests</a>. A recent addition in Intern 2.1 is a <code>skip</code> method to the context object for test methods. Using <code>this.skip()</code> allows you to clearly see in your tests results which tests were skipped (as opposed to using <code>dojo/has</code> to conditionally load test modules). Within Dojo, we include skip statements for tests we intentionally added for any tests that have not yet been converted from DOH to Intern. With environment-specific tests, ensure that your test execution process covers all relevant environments and that your reporting process verifies coverage.</p>\\n<p>We also include some helper utilities, for example there&#8217;s an <a href=\\\"https://github.com/dojo/dojo/blob/master/tests/support/undef.js\\\">undef module</a>, to reduce the boilerplate needed when <a href=\\\"https://www.sitepen.com/blog/2014/07/14/mocking-data-with-intern/\\\">mocking objects with Intern</a>. </p>\\n<h3>Mocking and spies</h3>\\n<p>While in many cases, writing <a href=\\\"https://www.sitepen.com/blog/2014/07/11/testable-code-best-practices/\\\">easily testable code</a> makes it easy to <a href=\\\"https://www.sitepen.com/blog/2014/07/14/mocking-data-with-intern/\\\">mock with Intern</a>, there are cases where having a library like <a href=\\\"http://sinonjs.org/\\\">Sinon.JS</a> made it much easier to test our code without modifying it to make it easier to test. For example, see the <a href=\\\"https://github.com/dojo/dojo/blob/7b0a4207ef602f89a1240215e273e552cf20fa50/tests/unit/throttle.js\\\">test for dojo/throttle</a>.</p>\\n<h3>Discipline</h3>\\n<p>One major point to follow with writing good tests is to make sure that the result of one test is not required for the next test. We found a number of cases within existing Dojo DOH tests where this was not the case, but with our new tests using Intern, we&#8217;ve taken a more disciplined approach. For example, the <a href=\\\"https://github.com/dojo/dojo/blob/1.10/tests/on/on.js\\\">original DOH-based <code>dojo/on</code> tests</a> were somewhat monolithic which made it difficult to parse the intent of the tests and convert. The converted <a href=\\\"https://github.com/dojo/dojo/blob/master/tests/unit/on.js\\\">Intern-based <code>dojo/on</code> tests</a> are decoupled into smaller, more focused pieces that are easier to read and understand.</p>\\n<h3>Unit vs. functional</h3>\\n<p>Anything that can be run as a unit test should be run as a unit test, and functional tests should be limited to things that must be run as a functional test. In general, unit tests are less complex, less fragile, and easier to create than functional tests. Of course, if you find yourself going through contortions and trickery to create a test (e.g. digging into API internals, generating synthetic events), maybe it should be a functional test instead.</p>\\n<p>As a result of this conversion, we&#8217;ve migrated some functional tests to unit tests wherever possible. An example of something that really must be a functional test: <a href=\\\"https://github.com/dojo/dojo/blob/7b0a4207ef602f89a1240215e273e552cf20fa50/tests/functional/touch.js\\\">dojo/touch, the API for working with touch events</a>.</p>\\n<p>The Intern packages <a href=\\\"https://github.com/theintern/leadfoot\\\">Leadfoot</a>, and WebDriver in general, allow you to create incredibly fast UI events (mouse, keyboard, etc.), in some cases much faster than a human can create. In some cases, you may need to slow things down to get them to work (e.g. <code>dojo/dnd</code>) by using <code><a href=\\\"https://theintern.github.io/leadfoot/Command.html#sleep\\\">Command#sleep</a></code>. Other areas where this may be essential include moving the mouse, creating/destroying DOM nodes, and triggering animations.</p>\\n<h3>Help wanted</h3>\\n<p>We can still use some help to complete this effort in time for Dojo 1.11:</p>\\n<ul>\\n<li><a href=\\\"https://github.com/dojo/dojo/pull/131\\\">Convert the remaining tests in Dojo core</a> (Hint: The tests that we currently skip are the ones that are missing, see the <a href=\\\"https://github.com/dojo/dojo/blob/master/tests/README.md\\\">testing README for instructions</a>)</li>\\n<li>Help convert Dijit and DojoX tests</li>\\n<li>Help backport tests to earlier Dojo releases once the core conversion is complete</li>\\n<li>Help determine a scalable solution to continuous integration</li>\\n</ul>\\n<p>Let us know if you would like to get involved!</p>\\n<h2>Learning more</h2>\\n<p>Creating an ideal approach to testing for your applications is a rewarding effort, but requires a significant up front investment to create a process that will work right for your organization. <a href=\\\"https://www.sitepen.com/contact/\\\">Contact us</a> for a free 30 minute consultation to discuss how we can help.</p>\\n\",\"protected\":false},\"excerpt\":{\"rendered\":\"<p>One of the primary motivations for creating Intern was to make support for continuous integration testing much easier to achieve with JavaScript-based application development. We recently converted the vast majority of the unit tests in Dojo core from DOH to Intern, in order to streamline the process of regression testing patches for Dojo 1.x. This [&hellip;]</p>\\n\",\"protected\":false},\"author\":3,\"featured_media\":6599,\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"sticky\":false,\"template\":\"\",\"format\":\"standard\",\"meta\":{\"spay_email\":\"\"},\"categories\":[353,45,375,3,16],\"tags\":[401],\"series\":[],\"jetpack_featured_media_url\":\"\",\"yoast_head\":\"<!-- This site is optimized with the Yoast SEO plugin v14.7 - https://yoast.com/wordpress/plugins/seo/ -->\\n<title>From DOH to Intern: Updating Dojo core&#039;s tests | SitePen</title>\\n<meta name=\\\"description\\\" content=\\\"One of the primary motivations for creating Intern was to make support for continuous integration testing much easier to achieve with JavaScript-based application development. We recently converted the vast majority of the unit tests in Dojo core from DOH to Intern, in order to streamline the process of regression testing\\\" />\\n<meta name=\\\"robots\\\" content=\\\"index, follow\\\" />\\n<meta name=\\\"googlebot\\\" content=\\\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\\\" />\\n<meta name=\\\"bingbot\\\" content=\\\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\\\" />\\n<link rel=\\\"canonical\\\" href=\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/\\\" />\\n<meta property=\\\"og:locale\\\" content=\\\"en_US\\\" />\\n<meta property=\\\"og:type\\\" content=\\\"article\\\" />\\n<meta property=\\\"og:title\\\" content=\\\"From DOH to Intern: Updating Dojo core&#039;s tests | SitePen\\\" />\\n<meta property=\\\"og:description\\\" content=\\\"One of the primary motivations for creating Intern was to make support for continuous integration testing much easier to achieve with JavaScript-based application development. We recently converted the vast majority of the unit tests in Dojo core from DOH to Intern, in order to streamline the process of regression testing\\\" />\\n<meta property=\\\"og:url\\\" content=\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/\\\" />\\n<meta property=\\\"og:site_name\\\" content=\\\"SitePen\\\" />\\n<meta property=\\\"article:publisher\\\" content=\\\"https://www.facebook.com/SitePen\\\" />\\n<meta property=\\\"article:published_time\\\" content=\\\"2015-02-18T17:11:36+00:00\\\" />\\n<meta property=\\\"og:image\\\" content=\\\"https://wp.sitepen.com/wp-content/uploads/2020/01/og_imageV1.jpg\\\" />\\n\\t<meta property=\\\"og:image:width\\\" content=\\\"1600\\\" />\\n\\t<meta property=\\\"og:image:height\\\" content=\\\"900\\\" />\\n<meta name=\\\"twitter:card\\\" content=\\\"summary_large_image\\\" />\\n<meta name=\\\"twitter:creator\\\" content=\\\"@SitePen\\\" />\\n<meta name=\\\"twitter:site\\\" content=\\\"@SitePen\\\" />\\n<script type=\\\"application/ld+json\\\" class=\\\"yoast-schema-graph\\\">{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@graph\\\":[{\\\"@type\\\":\\\"WebSite\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\",\\\"url\\\":\\\"https://wp.sitepen.com/\\\",\\\"name\\\":\\\"SitePen\\\",\\\"description\\\":\\\"Enterprise Web Apps Done Right\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://wp.sitepen.com/?s={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}],\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/#primaryimage\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"\\\"},{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/#webpage\\\",\\\"url\\\":\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/\\\",\\\"name\\\":\\\"From DOH to Intern: Updating Dojo core's tests | SitePen\\\",\\\"isPartOf\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\"},\\\"primaryImageOfPage\\\":{\\\"@id\\\":\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/#primaryimage\\\"},\\\"datePublished\\\":\\\"2015-02-18T17:11:36+00:00\\\",\\\"dateModified\\\":\\\"2015-02-18T17:11:36+00:00\\\",\\\"author\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/fdc7f111693e7de4d6f9f92d17079bd4\\\"},\\\"description\\\":\\\"One of the primary motivations for creating Intern was to make support for continuous integration testing much easier to achieve with JavaScript-based application development. We recently converted the vast majority of the unit tests in Dojo core from DOH to Intern, in order to streamline the process of regression testing\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"ReadAction\\\",\\\"target\\\":[\\\"https://www.sitepen.com/blog/from-doh-to-intern-updating-dojo-cores-tests/\\\"]}]},{\\\"@type\\\":[\\\"Person\\\"],\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/fdc7f111693e7de4d6f9f92d17079bd4\\\",\\\"name\\\":\\\"Dylan Schiemann\\\",\\\"image\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#personlogo\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=96&d=mm&r=g\\\",\\\"caption\\\":\\\"Dylan Schiemann\\\"}}]}</script>\\n<!-- / Yoast SEO plugin. -->\",\"_links\":{\"self\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts/10402\"}],\"collection\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts\"}],\"about\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/types/post\"}],\"author\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users/3\"}],\"replies\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/comments?post=10402\"}],\"version-history\":[{\"count\":0,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts/10402/revisions\"}],\"wp:featuredmedia\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/media/6599\"}],\"wp:attachment\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/media?parent=10402\"}],\"wp:term\":[{\"taxonomy\":\"category\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/categories?post=10402\"},{\"taxonomy\":\"post_tag\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/tags?post=10402\"},{\"taxonomy\":\"series\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/series?post=10402\"}],\"curies\":[{\"name\":\"wp\",\"href\":\"https://api.w.org/{rel}\",\"templated\":true}]},\"_embedded\":{\"author\":[{\"id\":3,\"name\":\"Dylan Schiemann\",\"url\":\"https://www.sitepen.com\",\"description\":\"\",\"link\":\"https://wp.sitepen.com/blog/author/dylan/\",\"slug\":\"dylan\",\"avatar_urls\":{\"24\":\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=24&d=mm&r=g\",\"48\":\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=48&d=mm&r=g\",\"96\":\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=96&d=mm&r=g\"},\"yoast_head\":\"<!-- This site is optimized with the Yoast SEO plugin v14.7 - https://yoast.com/wordpress/plugins/seo/ -->\\n<title>Dylan Schiemann, Author at SitePen</title>\\n<meta name=\\\"robots\\\" content=\\\"noindex, follow\\\" />\\n<meta property=\\\"og:locale\\\" content=\\\"en_US\\\" />\\n<meta property=\\\"og:type\\\" content=\\\"profile\\\" />\\n<meta property=\\\"og:title\\\" content=\\\"Dylan Schiemann, Author at SitePen\\\" />\\n<meta property=\\\"og:url\\\" content=\\\"https://www.sitepen.com/blog/author/dylan/\\\" />\\n<meta property=\\\"og:site_name\\\" content=\\\"SitePen\\\" />\\n<meta property=\\\"og:image\\\" content=\\\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=500&#038;d=mm&#038;r=g\\\" />\\n<meta name=\\\"twitter:card\\\" content=\\\"summary_large_image\\\" />\\n<meta name=\\\"twitter:site\\\" content=\\\"@SitePen\\\" />\\n<script type=\\\"application/ld+json\\\" class=\\\"yoast-schema-graph\\\">{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@graph\\\":[{\\\"@type\\\":\\\"WebSite\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\",\\\"url\\\":\\\"https://wp.sitepen.com/\\\",\\\"name\\\":\\\"SitePen\\\",\\\"description\\\":\\\"Enterprise Web Apps Done Right\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://wp.sitepen.com/?s={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}],\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":\\\"ProfilePage\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/author/dylan/#webpage\\\",\\\"url\\\":\\\"https://www.sitepen.com/blog/author/dylan/\\\",\\\"name\\\":\\\"Dylan Schiemann, Author at SitePen\\\",\\\"isPartOf\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\"},\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":[\\\"Person\\\"],\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/fdc7f111693e7de4d6f9f92d17079bd4\\\",\\\"name\\\":\\\"Dylan Schiemann\\\",\\\"image\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#personlogo\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"https://secure.gravatar.com/avatar/89916e31a2e6998f2aadde6f0bde6835?s=96&d=mm&r=g\\\",\\\"caption\\\":\\\"Dylan Schiemann\\\"},\\\"mainEntityOfPage\\\":{\\\"@id\\\":\\\"https://www.sitepen.com/blog/author/dylan/#webpage\\\"}}]}</script>\\n<!-- / Yoast SEO plugin. -->\",\"_links\":{\"self\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users/3\"}],\"collection\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users\"}]}}],\"wp:featuredmedia\":[{\"code\":\"rest_post_invalid_id\",\"message\":\"Invalid post ID.\",\"data\":{\"status\":404}}]}}]","headers":[["access-control-allow-headers","Authorization, X-WP-Nonce, Content-Disposition, Content-MD5, Content-Type"],["access-control-expose-headers","X-WP-Total, X-WP-TotalPages, Link"],["allow","GET"],["cache-control","max-age=2592000"],["connection","close"],["content-type","application/json; charset=UTF-8"],["date","Tue, 25 Aug 2020 13:14:06 GMT"],["expires","Thu, 24 Sep 2020 13:14:06 GMT"],["link","<https://wp.sitepen.com/wp-json/>; rel=\"https://api.w.org/\""],["server","Apache"],["transfer-encoding","chunked"],["vary","Origin"],["x-content-type-options","nosniff"],["x-powered-by","PHP/7.3.21-1+0~20200807.66+debian9~1.gbp18a1c2"],["x-robots-tag","noindex"],["x-wp-total","1"],["x-wp-totalpages","1"]]},"type":"Object"}