{"value":{"body":"[{\"id\":7248,\"date\":\"2013-12-04T09:52:54\",\"date_gmt\":\"2013-12-04T16:52:54\",\"guid\":{\"rendered\":\"https://www.sitepen.com/blog/?p=7248\"},\"modified\":\"2013-12-04T09:52:54\",\"modified_gmt\":\"2013-12-04T16:52:54\",\"slug\":\"persevere-on-heroku\",\"status\":\"publish\",\"type\":\"post\",\"link\":\"https://wp.sitepen.com/blog/persevere-on-heroku/\",\"title\":{\"rendered\":\"Persevere on Heroku\"},\"content\":{\"rendered\":\"<p>It is becoming increasingly popular to deploy <a href=\\\"http://nodejs.org/\\\">Node.js</a>-based applications to <a href=\\\"https://github.com/joyent/node/wiki/Node-Hosting\\\">Node-friendly hosting services</a> to take advantage of the pre-built, reliable, robust architecture and infrastructure these services provide. <a href=\\\"http://persvr.org/\\\">Persevere</a>, a JavaScript server framework for developing RESTful applications on Node.js, is an excellent fit for these types of hosting services. In this post I will show you how easily a Persevere application can be built and deployed on one such service, <a href=\\\"http://www.heroku.com\\\">Heroku</a>, but the process can be easily replicated on other providers that offer similar functionality.</p>\\n<p><!--more--></p>\\n<h2>Creating an application</h2>\\n<p>To begin with, you will need to create a free Heroku account, and then download and install the Heroku <a href=\\\"https://toolbelt.heroku.com/\\\">toolbelt</a> tool suite. Next, create a git repository for your application and use the <code>heroku</code> command to initialize the application itself. You will need to give your application a unique name; we&#8217;ll use &#8220;appname&#8221; for this example:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\ngit init\\nheroku apps:create appname\\n</pre>\\n<p>We can bootstrap our Persevere application with the <a href=\\\"https://github.com/persvr/persevere-template\\\">Persevere template</a> or the <a href=\\\"https://github.com/persvr/persevere-example-wiki\\\">Persevere example application</a>. To use the template, we could simply pull it into our application&#8217;s git repository:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\ngit pull https://github.com/persvr/persevere-template master\\n</pre>\\n<p>The template is complete enough that we could push it to Heroku and have a running server, but since it doesn&#8217;t have any data models or pages, it is not very interesting. You can read the <a href=\\\"http://persvr.org/Documentation\\\">Persevere documentation</a> for more information on setting up data models and other aspects of building an application. The Persevere example application is more complete, so we&#8217;ll use it instead:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\ngit pull https://github.com/persvr/persevere-example-wiki master\\n</pre>\\n<p>Create a <a href=\\\"https://devcenter.heroku.com/articles/getting-started-with-nodejs#declare-process-types-with-procfile\\\">Procfile</a> in your application repository that contains the single directive:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\nweb: node index.js\\n</pre>\\n<p>Commit this with git and then push it to Heroku:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\ngit push heroku master\\n</pre>\\n<p>After a successful push, Heroku will automatically install all the dependencies specified in the <code>package.json</code> file that was included in the example application. We can ensure that at least one web process is running with:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\nheroku ps:scale web=1\\n</pre>\\n<p>Your application should now start up. Persevere is setup to serve on the port specified by the <code>PORT</code> environment variable, which Heroku provides, so Persevere automatically starts on the correct port to interface with Heroku. You can verify this by looking at the Heroku logs:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\nheroku logs\\n</pre>\\n<p>You can test the application by visiting http://{appname}.heroku.com with your browser (replace {appname} with the unique name selected for your application). If the example wiki starts up properly, you should have an option to create/edit a new page (and to register and login as a new user) at the redirected URL.</p>\\n<h2>Switching data stores</h2>\\n<p>One of the benefits of Persevere is that we can actually start creating and prototyping an application with the default, fully functional JSON file-based store (which stores all data in memory and records changes to disk), and then later upgrade to a more robust, scalable database if needed. This can be as simple as swapping in a different data store. With Heroku, we can easily add <a href=\\\"http://www.mongodb.org/\\\">MongoDB</a> as an addon (I used <a href=\\\"https://addons.heroku.com/mongohq\\\">MongoHQ</a>) through the web interface or with the command:</p>\\n<pre class=\\\"brush: plain; title: ; notranslate\\\" title=\\\"\\\">\\nheroku addons:add mongohq\\n</pre>\\n<p>Note that although the use of MongoDB is free for small applications, Heroku requires you to add a credit card to your account to verify it.</p>\\n<p>To use Persevere&#8217;s MongoDB object store connector, we add the <a href=\\\"https://github.com/persvr/mongodb-store\\\">mongodb-store</a> package to the <code>dependencies</code> of our <code>package.json</code>:</p>\\n<pre class=\\\"brush: jscript; title: ; notranslate\\\" title=\\\"\\\">\\n  &quot;mongodb-store&quot;: &quot;&gt;=0.1.1&quot;\\n</pre>\\n<p>In the example wiki application we can swap out our data store for MongoDB by opening up the <code>model/page.js</code> module and assigning the value of the <code>pageStore</code> export of the <code>page-mongo</code> module to the <code>pageStore</code> variable (this is actually already available in the comments):</p>\\n<pre class=\\\"brush: jscript; title: ; notranslate\\\" title=\\\"\\\">\\nvar pageStore = require('./page-mongo').pageStore;\\n</pre>\\n<p>To use MongoDB on Heroku, we also need to modify <code>mode/page-mongo.js</code>. Edit this file and set the <code>url</code> variable to <code>process.env.MONGOHQ_URL</code>. Look at the rest of <code>model/page-mongo.js</code> to see how the MongoDB store is setup. Basically, a new store instance is constructed with the name of the collection you wish to use. When deployed on Heroku, Persevere will automatically detect the MongoDB URL, and the collection you specify will be created:</p>\\n<pre class=\\\"brush: jscript; title: ; notranslate\\\" title=\\\"\\\">\\nvar MongoDB = require(&quot;mongodb-store&quot;).MongoDB,\\n    myStore = MongoDB({collection: &quot;collection-name&quot;});\\n</pre>\\n<p>Finally, we commit and push again with git, and our application should start up with a connection to MongoDB. Any new pages created in the wiki will now be stored in the MongoDB database. We don&#8217;t have to make any further changes to the application; Persevere will map data manipulation operations as well as <a href=\\\"https://github.com/persvr/rql\\\">RQL</a> queries to MongoDB so they can be used in the same way as with the default store.</p>\\n<p>Hopefully this example gives you an idea of how easily Persevere applications can be deployed to NodeJS hosting services, taking advantage of Persevere default settings, NPM installation capabilities, and switching to hosted add-on database services when appropriate. Let us know if you have any questions.</p>\\n\",\"protected\":false},\"excerpt\":{\"rendered\":\"<p>It is becoming increasingly popular to deploy Node.js-based applications to Node-friendly hosting services to take advantage of the pre-built, reliable, robust architecture and infrastructure these services provide. Persevere, a JavaScript server framework for developing RESTful applications on Node.js, is an excellent fit for these types of hosting services. In this post I will show you [&hellip;]</p>\\n\",\"protected\":false},\"author\":28,\"featured_media\":7489,\"comment_status\":\"open\",\"ping_status\":\"open\",\"sticky\":false,\"template\":\"\",\"format\":\"standard\",\"meta\":{\"spay_email\":\"\"},\"categories\":[3,178],\"tags\":[],\"series\":[],\"jetpack_featured_media_url\":\"\",\"yoast_head\":\"<!-- This site is optimized with the Yoast SEO plugin v14.5 - https://yoast.com/wordpress/plugins/seo/ -->\\n<title>Persevere on Heroku | SitePen</title>\\n<meta name=\\\"robots\\\" content=\\\"index, follow\\\" />\\n<meta name=\\\"googlebot\\\" content=\\\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\\\" />\\n<meta name=\\\"bingbot\\\" content=\\\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\\\" />\\n<link rel=\\\"canonical\\\" href=\\\"https://www.sitepen.com/blog/persevere-on-heroku/\\\" />\\n<meta property=\\\"og:locale\\\" content=\\\"en_US\\\" />\\n<meta property=\\\"og:type\\\" content=\\\"article\\\" />\\n<meta property=\\\"og:title\\\" content=\\\"Persevere on Heroku | SitePen\\\" />\\n<meta property=\\\"og:description\\\" content=\\\"It is becoming increasingly popular to deploy Node.js-based applications to Node-friendly hosting services to take advantage of the pre-built, reliable, robust architecture and infrastructure these services provide. Persevere, a JavaScript server framework for developing RESTful applications on Node.js, is an excellent fit for these types of hosting services. In this post I will show you [&hellip;]\\\" />\\n<meta property=\\\"og:url\\\" content=\\\"https://www.sitepen.com/blog/persevere-on-heroku/\\\" />\\n<meta property=\\\"og:site_name\\\" content=\\\"SitePen\\\" />\\n<meta property=\\\"article:publisher\\\" content=\\\"https://www.facebook.com/SitePen\\\" />\\n<meta property=\\\"article:published_time\\\" content=\\\"2013-12-04T16:52:54+00:00\\\" />\\n<meta property=\\\"og:image\\\" content=\\\"https://wp.sitepen.com/wp-content/uploads/2020/01/og_imageV1.jpg\\\" />\\n\\t<meta property=\\\"og:image:width\\\" content=\\\"1600\\\" />\\n\\t<meta property=\\\"og:image:height\\\" content=\\\"900\\\" />\\n<meta name=\\\"twitter:card\\\" content=\\\"summary_large_image\\\" />\\n<meta name=\\\"twitter:creator\\\" content=\\\"@SitePen\\\" />\\n<meta name=\\\"twitter:site\\\" content=\\\"@SitePen\\\" />\\n<script type=\\\"application/ld+json\\\" class=\\\"yoast-schema-graph\\\">{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@graph\\\":[{\\\"@type\\\":\\\"WebSite\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\",\\\"url\\\":\\\"https://wp.sitepen.com/\\\",\\\"name\\\":\\\"SitePen\\\",\\\"description\\\":\\\"Enterprise Web Apps Done Right\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://wp.sitepen.com/?s={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}],\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/persevere-on-heroku/#primaryimage\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"\\\"},{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/persevere-on-heroku/#webpage\\\",\\\"url\\\":\\\"https://www.sitepen.com/blog/persevere-on-heroku/\\\",\\\"name\\\":\\\"Persevere on Heroku | SitePen\\\",\\\"isPartOf\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\"},\\\"primaryImageOfPage\\\":{\\\"@id\\\":\\\"https://www.sitepen.com/blog/persevere-on-heroku/#primaryimage\\\"},\\\"datePublished\\\":\\\"2013-12-04T16:52:54+00:00\\\",\\\"dateModified\\\":\\\"2013-12-04T16:52:54+00:00\\\",\\\"author\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/0b6eaf72ddf34f8c761763c239c05087\\\"},\\\"inLanguage\\\":\\\"en-US\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"ReadAction\\\",\\\"target\\\":[\\\"https://www.sitepen.com/blog/persevere-on-heroku/\\\"]}]},{\\\"@type\\\":[\\\"Person\\\"],\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/0b6eaf72ddf34f8c761763c239c05087\\\",\\\"name\\\":\\\"Kris Zyp\\\",\\\"image\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#personlogo\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=96&d=mm&r=g\\\",\\\"caption\\\":\\\"Kris Zyp\\\"}}]}</script>\\n<!-- / Yoast SEO plugin. -->\",\"_links\":{\"self\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts/7248\"}],\"collection\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts\"}],\"about\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/types/post\"}],\"author\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users/28\"}],\"replies\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/comments?post=7248\"}],\"version-history\":[{\"count\":0,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/posts/7248/revisions\"}],\"wp:featuredmedia\":[{\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/media/7489\"}],\"wp:attachment\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/media?parent=7248\"}],\"wp:term\":[{\"taxonomy\":\"category\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/categories?post=7248\"},{\"taxonomy\":\"post_tag\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/tags?post=7248\"},{\"taxonomy\":\"series\",\"embeddable\":true,\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/series?post=7248\"}],\"curies\":[{\"name\":\"wp\",\"href\":\"https://api.w.org/{rel}\",\"templated\":true}]},\"_embedded\":{\"author\":[{\"id\":28,\"name\":\"Kris Zyp\",\"url\":\"https://www.sitepen.com\",\"description\":\"\",\"link\":\"https://wp.sitepen.com/blog/author/kzyp/\",\"slug\":\"kzyp\",\"avatar_urls\":{\"24\":\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=24&d=mm&r=g\",\"48\":\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=48&d=mm&r=g\",\"96\":\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=96&d=mm&r=g\"},\"yoast_head\":\"<!-- This site is optimized with the Yoast SEO plugin v14.5 - https://yoast.com/wordpress/plugins/seo/ -->\\n<title>Kris Zyp, Author at SitePen</title>\\n<meta name=\\\"robots\\\" content=\\\"noindex, follow\\\" />\\n<meta property=\\\"og:locale\\\" content=\\\"en_US\\\" />\\n<meta property=\\\"og:type\\\" content=\\\"profile\\\" />\\n<meta property=\\\"og:title\\\" content=\\\"Kris Zyp, Author at SitePen\\\" />\\n<meta property=\\\"og:url\\\" content=\\\"https://www.sitepen.com/blog/author/kzyp/\\\" />\\n<meta property=\\\"og:site_name\\\" content=\\\"SitePen\\\" />\\n<meta property=\\\"og:image\\\" content=\\\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=500&#038;d=mm&#038;r=g\\\" />\\n<meta name=\\\"twitter:card\\\" content=\\\"summary_large_image\\\" />\\n<meta name=\\\"twitter:site\\\" content=\\\"@SitePen\\\" />\\n<script type=\\\"application/ld+json\\\" class=\\\"yoast-schema-graph\\\">{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@graph\\\":[{\\\"@type\\\":\\\"WebSite\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\",\\\"url\\\":\\\"https://wp.sitepen.com/\\\",\\\"name\\\":\\\"SitePen\\\",\\\"description\\\":\\\"Enterprise Web Apps Done Right\\\",\\\"potentialAction\\\":[{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://wp.sitepen.com/?s={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}],\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":\\\"ProfilePage\\\",\\\"@id\\\":\\\"https://www.sitepen.com/blog/author/kzyp/#webpage\\\",\\\"url\\\":\\\"https://www.sitepen.com/blog/author/kzyp/\\\",\\\"name\\\":\\\"Kris Zyp, Author at SitePen\\\",\\\"isPartOf\\\":{\\\"@id\\\":\\\"https://wp.sitepen.com/#website\\\"},\\\"inLanguage\\\":\\\"en-US\\\"},{\\\"@type\\\":[\\\"Person\\\"],\\\"@id\\\":\\\"https://wp.sitepen.com/#/schema/person/0b6eaf72ddf34f8c761763c239c05087\\\",\\\"name\\\":\\\"Kris Zyp\\\",\\\"image\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"@id\\\":\\\"https://wp.sitepen.com/#personlogo\\\",\\\"inLanguage\\\":\\\"en-US\\\",\\\"url\\\":\\\"https://secure.gravatar.com/avatar/0c073304e94b11bc5a45aa6a3b5fedb7?s=96&d=mm&r=g\\\",\\\"caption\\\":\\\"Kris Zyp\\\"},\\\"mainEntityOfPage\\\":{\\\"@id\\\":\\\"https://www.sitepen.com/blog/author/kzyp/#webpage\\\"}}]}</script>\\n<!-- / Yoast SEO plugin. -->\",\"_links\":{\"self\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users/28\"}],\"collection\":[{\"href\":\"https://wp.sitepen.com/wp-json/wp/v2/users\"}]}}],\"wp:featuredmedia\":[{\"code\":\"rest_post_invalid_id\",\"message\":\"Invalid post ID.\",\"data\":{\"status\":404}}]}}]","headers":[["access-control-allow-headers","Authorization, Content-Type"],["access-control-expose-headers","X-WP-Total, X-WP-TotalPages"],["allow","GET"],["cf-cache-status","DYNAMIC"],["cf-ray","5b01ab2cde980792-LHR"],["cf-request-id","03d4e9500b000007928e311200000001"],["connection","close"],["content-encoding","gzip"],["content-type","application/json; charset=UTF-8"],["date","Thu, 09 Jul 2020 11:22:42 GMT"],["expect-ct","max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\""],["link","<https://wp.sitepen.com/wp-json/>; rel=\"https://api.w.org/\""],["server","cloudflare"],["set-cookie","__cfduid=dc2e33899f5989727a53522493079449c1594293762; expires=Sat, 08-Aug-20 11:22:42 GMT; path=/; domain=.sitepen.com; HttpOnly; SameSite=Lax"],["transfer-encoding","chunked"],["vary","Origin"],["x-content-type-options","nosniff"],["x-powered-by","PHP/7.3.16-1+0~20200320.56+debian9~1.gbp370a75"],["x-robots-tag","noindex"],["x-wp-total","1"],["x-wp-totalpages","1"]]},"type":"Object"}